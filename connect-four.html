<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>〇×4つ並べ</title>
<style>
  body {
    font-family: sans-serif;
    text-align: center;
    margin-top: 20px;
  }
  #board {
    display: grid;
    grid-template-columns: repeat(7, 60px);
    grid-template-rows: repeat(7, 60px);
    gap: 5px;
    justify-content: center;
    margin: 0 auto;
    width: 455px;
  }
  .cell {
    width: 60px;
    height: 60px;
    border: 1px solid #333;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2em;
    cursor: pointer;
    user-select: none;
  }
  #message {
    margin-top: 20px;
    font-size: 1.5em;
  }
  #reset {
    margin-top: 10px;
    padding: 5px 15px;
  }
</style>
</head>
<body>
<h1>〇×4つ並べ</h1>
<div id="board"></div>
<div id="message"></div>
<button id="reset">リセット</button>
<script>
const boardEl = document.getElementById('board');
const message = document.getElementById('message');
const board = Array.from({length:7}, () => Array(7).fill(null));
let current = '○';
let gameOver = false;

// セルを生成
for (let r = 0; r < 7; r++) {
  for (let c = 0; c < 7; c++) {
    const cell = document.createElement('div');
    cell.className = 'cell';
    cell.dataset.row = r;
    cell.dataset.col = c;
    cell.addEventListener('click', handleClick);
    boardEl.appendChild(cell);
  }
}

function handleClick(e) {
  if (gameOver) return;
  const col = Number(e.target.dataset.col);
  for (let r = 6; r >= 0; r--) {
    if (!board[r][col]) {
      board[r][col] = current;
      const idx = r * 7 + col;
      boardEl.children[idx].textContent = current;
      if (checkWin(r, col)) {
        message.textContent = `${current}の勝ち`;
        gameOver = true;
      } else if (board.flat().every(v => v)) {
        message.textContent = '引き分け';
        gameOver = true;
      } else {
        current = current === '○' ? '×' : '○';
      }
      break;
    }
  }
}

function checkWin(r, c) {
  const mark = board[r][c];
  const dirs = [[1,0],[0,1],[1,1],[1,-1]];
  for (const [dr, dc] of dirs) {
    let count = 1;
    let nr = r + dr, nc = c + dc;
    while (nr >= 0 && nr < 7 && nc >= 0 && nc < 7 && board[nr][nc] === mark) {
      count++; nr += dr; nc += dc;
    }
    nr = r - dr; nc = c - dc;
    while (nr >= 0 && nr < 7 && nc >= 0 && nc < 7 && board[nr][nc] === mark) {
      count++; nr -= dr; nc -= dc;
    }
    if (count >= 4) return true;
  }
  return false;
}

document.getElementById('reset').addEventListener('click', resetGame);

function resetGame() {
  for (let r = 0; r < 7; r++) {
    for (let c = 0; c < 7; c++) {
      board[r][c] = null;
    }
  }
  [...boardEl.children].forEach(cell => cell.textContent = '');
  message.textContent = '';
  current = '○';
  gameOver = false;
}
</script>
</body>
</html>
