<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>迷路ゲーム</title>
<style>
  body {
    font-family: sans-serif;
    text-align: center;
    margin-top: 20px;
  }
  #container {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    margin-top: 10px;
  }
  #maze {
    border: 1px solid #333;
    background: #fff;
  }
  #records {
    margin-left: 20px;
    text-align: left;
  }
</style>
</head>
<body>
<h1>迷路ゲーム</h1>
<button id="startBtn">スタート</button>
<span id="timer">00.0</span>
<div id="container">
  <canvas id="maze" width="420" height="420"></canvas>
  <div id="records">
    <h3>タイム</h3>
    <ol id="times"></ol>
  </div>
</div>
<script>
const size = 21; // 奇数
const cellSize = 20;
const canvas = document.getElementById('maze');
const ctx = canvas.getContext('2d');
const timerEl = document.getElementById('timer');
const timesEl = document.getElementById('times');
let maze, player, goal;
let timer = 0;
let interval;
let records = [];

function generateMaze() {
  // 0: wall, 1: path
  maze = Array.from({length: size}, () => Array(size).fill(0));
  function carve(x, y) {
    const dirs = [[2,0],[-2,0],[0,2],[0,-2]];
    shuffle(dirs);
    for (const [dx,dy] of dirs) {
      const nx = x + dx, ny = y + dy;
      if (nx > 0 && nx < size-1 && ny > 0 && ny < size-1 && maze[ny][nx] === 0) {
        maze[ny-dy/2][nx-dx/2] = 1;
        maze[ny][nx] = 1;
        carve(nx, ny);
      }
    }
  }
  maze[1][1] = 1;
  carve(1,1);
  player = {x:1, y:1};
  goal = {x:size-2, y:size-2};
  maze[goal.y][goal.x] = 1;
}

function shuffle(arr) {
  for (let i = arr.length-1;i>0;i--) {
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
}

function draw() {
  ctx.fillStyle = '#fff';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = '#000';
  for (let y=0;y<size;y++) {
    for (let x=0;x<size;x++) {
      if (maze[y][x]===0) {
        ctx.fillRect(x*cellSize,y*cellSize,cellSize,cellSize);
      }
    }
  }
  // start
  ctx.fillStyle = '#8e44ad';
  ctx.fillRect(1*cellSize,1*cellSize,cellSize,cellSize);
  // goal
  ctx.fillStyle = '#e74c3c';
  ctx.fillRect(goal.x*cellSize,goal.y*cellSize,cellSize,cellSize);
  // player
  ctx.fillStyle = '#2ecc71';
  ctx.fillRect(player.x*cellSize,player.y*cellSize,cellSize,cellSize);
}

function startGame() {
  generateMaze();
  draw();
  timer = 0;
  timerEl.textContent = '00.0';
  clearInterval(interval);
  interval = setInterval(()=>{
    timer += 0.1;
    timerEl.textContent = timer.toFixed(1).padStart(4,'0');
  },100);
}

function finish() {
  clearInterval(interval);
  records.push(timer);
  records.sort((a,b)=>a-b);
  if (records.length>5) records = records.slice(0,5);
  timesEl.innerHTML = '';
  for (const t of records) {
    const li = document.createElement('li');
    li.textContent = t.toFixed(1)+'s';
    timesEl.appendChild(li);
  }
}

document.getElementById('startBtn').addEventListener('click', startGame);

document.addEventListener('keydown', e => {
  if (!maze) return;
  let {x,y} = player;
  if (e.key==='ArrowUp') y--;
  else if (e.key==='ArrowDown') y++;
  else if (e.key==='ArrowLeft') x--;
  else if (e.key==='ArrowRight') x++;
  if (maze[y] && maze[y][x]===1) {
    player.x = x;
    player.y = y;
    draw();
    if (x===goal.x && y===goal.y) finish();
  }
});
</script>
</body>
</html>
